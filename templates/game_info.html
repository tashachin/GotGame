{% extends 'base.html' %}
<!-- Stylesheets and scripts that need to be loaded before the HTML -->
{% block hscripts %}
<link rel='stylesheet'
	  href='https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css'>
<script src='https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js'></script>
<script
  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous"></script>
<script src='/static/game_results.js'></script>
{% endblock %}

{% block title %} {{ game.title }} {% endblock %}

{% block content %}

<h2> {{ game.title }} </h2>

<!-- GAME INFORMATION -->

<div class='game-table'>
<table id='game-info-table' 
	   class='stripe' 
	   cellspace='0' 
	   width='100%'>
	<thead>
	<tr>
		<th>Platform</th>
		<th>Genre</th>
		<th>Score (IGN)</th>
		<th>Score (Users)</th>
	</tr>
	</thead>
	<tbody>
		<tr>
			<td>{{ game.platform }}</td>
			<td>{% for vg_genre in vg_genres %}
				{{ vg_genre.genre.genre_type }}{% if not loop.last %},{% endif %}
				{% endfor %}</td>
			<td>{{ game.critic_score }}</td>
			<td>{% if review %}
				{{ game.aggregate_score }}
				{% else %}
				N/A
				{% endif %}</td>

		</tr>
	</tbody>
</table>
</div>



<!-- LINK BACK TO ADV SEARCH -->

<div>

	<a href='/adv-search'>Not what you were looking for?</a>

</div>

<!-- GAME DESCRIPTION -->

<!-- <div id='game-desc'>
	<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
</div> -->

{% if user_status %}

<!-- USER'S APPLIED TAGS -->

<div id='game-tags'>

	( tags go here )

</div>

<!-- MODAL FOR APPLYING TAGS -->

<aside>

	<button type="button" 
			class="btn btn-primary" 
			data-toggle="modal" 
			data-target="#add-tag">
	  Tag this game
	</button>

	<div id="add-tag" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
    <div class="modal-content">
    <div class="modal-header">

        <h4 class="modal-title">{{ game.title }}</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>

    </div>
    <div class="modal-body">

        <p>
        	<form id='create-tags-form'>
        		<input type='text' 
        			   name='new_tags' 
        			   placeholder='Separate tags by commas'>
        		<input id='create-tags' 
        			   class='btn btn-default' 
        			   type='submit'
        			   value='Create new tags'>
        	</form>
        	<div id='tag-notif' hidden>SUCCESS!</div>
    	</p>
    	<hr>
    	<div id='drag-and-drop-tags'>
    	<p> 
    		<label>Tags:</label>
    		<div id='tag-field'>
      		{% for tag in tags %}
      		<span id='{{tag.tag_id}}'
      			  class='draggable badge badge-secondary' 
      		      name='{{tag.tag}}'>
      		{{ tag.tag }}
      		</span>
      		{% endfor %}
      		</div>
      		<!-- Jinja templating will replace all those placeholder values when it's working -->
      		<hr>
      		<label>{{ game.title }} is tagged under:</label>
      		<div id='attach-tags-field'
      			 class='droppable well'
      			 >
      		</div>
      	</p>
      	<form id='edit-tags-form'>
      	<input id='edit-tags'
      	       class='btn btn-default'
      	       type='submit'
      	       value='Save changes'>
		</form>
        </div>
    </div>

    <div class="modal-footer">

        <button type="button" 
        	    class="btn btn-secondary" 
        	    data-dismiss="modal">
        	    Close
        </button>

    </div>
	</div>
	</div>
	</div>

<!-- COMMENT THREAD -->

<!-- 3.0 - Allow users to create a discussion thread on any given game page. -->
<!-- <div id='comment-field'>
	<ul>
		<li></li>
	</ul>
</div> -->

</aside>

<!-- REVIEW FORM -->

<div id='review-field'>

	<div id='user-review'>
		<!-- Remember to test for WHO user is -->

		{% if review %}
		<!-- When refactoring, create just one review form.
		Under "if review" conditional, set a review.review_id hidden value -->
		<p>
		Previously, you said: "{{ review.review }}"
		<br>
		You gave this game a {{ review.user_score }} out of 10.
		</p>

		<div id='edit-review-notif' hidden>Your review of {{ game.title }} has been updated!</div>

		<div class='row'>

		<form id='update-review-form'>

			<div class="form-group">
			<div class="col-xs-2">
			<label for='edit-score'>Score:</label>
			<input id='edit-score' 
				   type='number' 
				   class='form-control' 
				   name='edit_user_score' 
				   placeholder='#' 
				   min=1.0 
				   max=10.0 
				   required>
			</div>
			</div>

			<div class="form-group">
			<div class="col-xs-4">
			<label for='edit-review'>Review:</label>
			<input id='edit-review' 
				   type='textarea' 
				   class='form-control' 
				   name='edit_review' 
				   placeholder='Update your review'>
			</div>
			</div>
		</div>
			<!-- Pass the game's id back to Python -->
			<input id='game-id-2' 
				   type='hidden' 
				   name='game_id'
				   value='{{ game.game_id }}'>

			<div class='row'>
			<div class="col-sm-6">
			<input id='change-review' 
				    type='submit' 
				    class='btn btn-primary'
				    value='Edit review'>
			</button>
			</div>
			</div>
		</form>

		{% else %}

		<p id='review-status'>You haven't reviewed this game yet!</p>
		<div id='review-notif' hidden>Your review of {{ game.title }} has been added!</div>

		<form id='review-form'>

			<input id='new-score' 
				   type='number' 
				   name='user_score' 
				   placeholder='#' 
				   min=1 
				   max=10 
				   required>

			<input id='new-review' 
				   type='textarea' 
				   class='form-control' 
				   name='review' 
				   placeholder='Write a review'>

			<input id='game-id' 
				   type='hidden' 
				   name='game_id' 
				   value='{{ game.game_id }}'>

			<input id='submit-review'
				   type='submit'
				   value='Review {{ game.title }}'>

		</form>
		{% endif %}
	</div>
</div>
{% endif %}

<!-- OTHER USERS' REVIEWS -->

{% if reviews %}
<div id='all-reviews'>
<ul>
	{% for review in reviews %}

	{% if review.user_id != session['user_id'] %}
	<li><a href="/user/{{ review.user.user_id }}">{{ review.user.username }}</a> 
		had this to say: "{{ review.review }}"</li>
	{% endif %}

	{% endfor %}
</ul>
</div>
{% endif %}

{% block fscripts %}
<script src='/static/game_info.js'></script>
{% endblock %}

{% endblock %}